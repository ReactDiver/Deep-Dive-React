# 1. useState
- 함수 컴포넌트 내부에서 상태를 정의하고, 이 상태를 관리할 수 있게 해주는 훅이다.
<br>

### useState 구현 살펴보기
```typescript
import { useState } from 'react'

const [state, setState] = useState(initialState)

// useState의 인수로는 사용할 state 값을 넘겨준다. 아무런 값을 넘겨주지 않으면 초깃값은 undefined다.
// useState 훅의 반환 값은 배열이며, 배열의 첫 번째 원소로 state 값 자체를 사용할 수 있고,
// 두 번째 원소인 setState 함수를 사용해 해당 state의 값을 변경할 수 있다.
```
- 매번 실행되는 함수 컴포넌트 환경에서 `state` 값을 유지하고 사용하기 위해서 리액트는 <mark>클로저</mark>를 활용하고 있다.
- 클로저를 사용함으로써 외부에 해당 값을 노출시키지 않고 오직 리액트에서만 쓸 수 있고,
- 함수 컴포넌트가 매번 실행되더라도 `useState`에서 이전의 값을 정확하게 꺼내 쓸 수 있다.
<br>

### 게으른 초기화
- `useState`에 변수 대신 <mark>함수</mark>를 넘기는 것을 게으른 초기화(lazy initialization)라고 한다.
```typescript
const [count, setCount] = useState(() =>
  Number.parseInt(sindow.localStorage.getItem(cacheKey)),
)
```
- 리액트 공식 문서에서 게으른 초기화는 useState의 초깃값이 복잡하거나 무거운 연산을 포함하고 있을 때 사용하라고 명시되어 있다.

  - 예) `localStorage`나 `sessionStorage`에 대한 접근, `map`, `filter`, `find` 같은 배열에 대한 접근, 초깃값 계산을 위해 함수 호출이 필요할 때
- 오로지 state가 처음 만들어질 때만 사용되고, 이후에 리렌더링이 발생하면 이 함수의 실행은 무시된다.
<br>

# 2. useEffect
- 애플리케이션 내 컴포넌트의 여러 값들을 활용해 동기적으로 부수 효과를 만드는 메커니즘이다.
```typescript
function Component() {
  // ...
  useEffect(() => {
    // do something
  }, [props, state])
  // 첫 번째 인수로는 실행할 부수 효과가 포함된 함수를
  // 두 번째 인수로는 의존성 배열을 전달한다.

  // 의존성 배열이 변경될 때마다 useEffect의 첫 번째 인수인 콜백을 실행한다.
}
```
- useEffect는 자바스크립트의 proxy나 데이터 바인딩, 옵저버 같은 특별한 기능을 통해 값의 변화를 관찰하는 것이 아니고,
- 렌더링할 때마다 의존성에 있는 값을 보면서 이 의존성의 값이 이전과 다른 게 하나라도 있으면 부수 효과를 실행하는 평범한 함수라 볼 수 있다.
<br>

### 클린업 함수의 목적
- useEffect 내에서 반환되는 클린업 함수는 일반적으로 이벤트를 등록하고 지울 때 사용해야 한다고 알려져 있다.
```typescript
// ...
function handleClick() {
  setCounter((prev) => prev + 1)
}

useEffect(() => {
  function addMouseEvent() {
    console.log(1)
  }

  window.addEventListener('click', addMouseEvent)

  // 클린업 함수
  // 클린업 함수는 이전 counter 값, 즉 이전 state를 참조해 실행된다.
  return () => {
    console.log('클린업 함수 실행!', counter) // 0, 1, 2
    window.removeEventListener('click', addMouseEvent)
  }
}, [counter])

return (
  <>
    <h1>{counter}</h1> // 1, 2, 3
    <button onClick={handleClick}+</button>
  </>
)
```
- 함수 컴포넌트의 useEffect는 콜백이 실행될 때마다 이전의 클린업 함수가 존재한다면 그 클린업 함수를 실행한 뒤에 콜백을 실행한다.

  - 이벤트를 추가하기 전에 이전에 등록했던 이벤트 핸들러를 삭제하는 코드를 클린업 함수에 추가하는 것이다.
  - 이렇게 함으로써 특정 이벤트의 핸들러가 무한히 추가되는 것을 방지할 수 있다.
