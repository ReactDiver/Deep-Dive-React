# 1장 리액트 개발을 위해 꼭 알아야 할 자바스크립트 

## 1-5. 이벤트 루프와 비동기 통신의 이해 

### 싱글 스레드 자바스크립트
- 자바스크립트는 한번에 하나의 작업만 동기 방식으로 처리
- **동기(synchronous)** : 직렬 방식으로 처리, 요청이 시작된 후 무조건 응답을 받고나서 다른 작업을 처리할 수 있다, 그동안 다른 작업은 대기함
- **비동기(asynchronous)** : 병렬 방식으로 처리, 요청이 시작한 후 응답이 오건말건 다음 작업이 이루어져 한번에 여러 작업 실행
- 스레드(thread) : 하나의 프로세스에서 여러 스레드를 만들 수 있고 스레드끼리는 메모리를 공유해 여러 작업 동시 수행 가능

```js
console.log(1)

setTimeout(() => {
  console.log(2)
}, 0)

setTimeout(() => {
  console.log(3)
}, 100)

console.log(4)
//1, 4, 2, 3 순서로 출력
```

### 이벤트 루프
- 이벤트 루프 : 자바스크립트 런타임 외부에서 자바스크립트 비동기 실행을 돕기 위해 만들어진 장치

#### 호출 스택과 이벤트 루프
- **호출 스택(call stack)** : 자바스크립트에서 수행해야 할 코드나 함수를 순차적으로 담아두는 스택
```js
function bar(){
  console.log("bar")
}

function baz(){
  console.log("baz")
}

function foo(){
  console.log("foo")
  bar()
  baz()  
}
foo()
//foo , bar, baz 순
```
```
- 호출 스택 과정
1. foo() 호출
   - 호출 스택: [foo]
2. foo 함수 내부 console.log 실행
   - 호출 스택: [foo]
3. foo 함수 내부 bar() 호출
   - 호출 스택: [bar, foo]
4. bar 함수 내부에서 console.log 실행
   - 호출 스택: [bar, foo]
5. bar 함수 종료되고 호출 스택에서 제거
   - 호출 스택: [foo]
6. foo 함수 내부에서 baz() 함수 호출
   - 호출 스택: [baz, foo]
7. baz 함수 내부 console.log 실행
   - 호출 스택: [baz, foo]
8. baz 함수 종료되고 호출 스택에서 제거
   - 호출 스택: [foo]
9. foo 함수 모든 명령 실행, foo 함수 종료되고 호출 스택에서 제거
    - 호출 스택: []
```
- 이 호출 스택이 비어 있는지 여부를 확인하는 것이 **이벤트 루프**

- 태스크 큐 : 실행해야 할 태스크의 집합으로 이벤트 루프는 태스크 큐를 한 개 이상 가지고 있음 <br/>
            이름과 다르게 자료 구조의 큐가 아니고 set 형태이다 실행 가능한 가장 오래된 태스크를 가져와야 하기 때문
  
- 이벤트 루프의 역할 : 호출 스택에 실행 중인 코드가 있는지, 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인
- 자바스크립트 코드 실행은 싱글 스레드에서 이루어지지만 web api 등은 모두 외부에서 실행되고 콜백이 태스크 큐로 들어간다
- 이벤트 루프는 호출 스택이 비고 콜백이 실행 가능한 때가 오면 이것을 꺼내서 수행하는 역할을 한다

### 태스크 큐와 마이크로 태스크 큐
- 이벤트 루프는 하나의 마이크로 태스트 큐를 갖고 있다
- 마이크로 태스크 큐의 대표적인게 Promise
- 마이크로 태스크 큐는 기존 태스크 큐보다 우선권을 가진다

```
태스크 큐 : setTimeout, setInterval, setImmediate
마이크로 태스크 큐 : process, nextTick, Promise, queueMicroTask, MutationObserver
```

#### 정리
- 자바스크립트 코드 실행 자체는 싱글 스레드기 때문에 비동기 처리가 어렵지만
- 자바스크립트 코드 실행 외에 태스크 큐, 이벤트 루프, 마이크로 태스트 큐, 브라우/Node.js API 등이 <br/>
  싱글 스레드로 불가능한 비동기 이벤트 처리를 가능하게 해준다. 
